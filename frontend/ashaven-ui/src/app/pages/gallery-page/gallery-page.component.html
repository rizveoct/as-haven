<app-gallery-hero></app-gallery-hero>

<section class="gallery-section" id="projectGallery">
  <div class="gallery-section__glow gallery-section__glow--left" aria-hidden="true"></div>
  <div class="gallery-section__glow gallery-section__glow--right" aria-hidden="true"></div>

  <div class="gallery-shell">
    <header class="gallery-intro fade-up">
      <span class="gallery-eyebrow">
        <span class="gallery-eyebrow__dot"></span>
        Immersive moments
      </span>
      <div class="gallery-heading">
        <h2 class="gallery-title">Project Gallery</h2>
        <p class="gallery-description">
          From visionary renderings to lived-in scenes, explore the curated narratives that define AS Haven. Every capture celebrates light,
          craftsmanship, and the mood of each residence.
        </p>
      </div>

      <dl class="gallery-totals" aria-label="Gallery totals">
        <div class="gallery-total">
          <dt class="gallery-total__label">Total</dt>
          <dd class="gallery-total__value">{{ totalItems }}</dd>
        </div>
        <div class="gallery-total">
          <dt class="gallery-total__label">Images</dt>
          <dd class="gallery-total__value">{{ totalImages }}</dd>
        </div>
        <div class="gallery-total">
          <dt class="gallery-total__label">Videos</dt>
          <dd class="gallery-total__value">{{ totalVideos }}</dd>
        </div>
      </dl>
    </header>

    <div
      class="gallery-toolbar fade-up"
      role="region"
      aria-live="polite"
      aria-label="Gallery controls"
    >
      <div class="gallery-filters" role="tablist" aria-label="Gallery filters">
        <button
          type="button"
          class="gallery-filter"
          [class.is-active]="activeFilter === 'all'"
          (click)="setFilter('all')"
          [attr.aria-pressed]="activeFilter === 'all'"
          role="tab"
          [attr.aria-selected]="activeFilter === 'all'"
        >
          <span class="gallery-filter__label">All</span>
          <span class="gallery-filter__count">{{ totalItems }}</span>
        </button>

        <button
          type="button"
          class="gallery-filter"
          [class.is-active]="activeFilter === 'image'"
          (click)="setFilter('image')"
          [attr.aria-pressed]="activeFilter === 'image'"
          role="tab"
          [attr.aria-selected]="activeFilter === 'image'"
        >
          <span class="gallery-filter__label">Images</span>
          <span class="gallery-filter__count">{{ totalImages }}</span>
        </button>

        <button
          type="button"
          class="gallery-filter"
          [class.is-active]="activeFilter === 'video'"
          (click)="setFilter('video')"
          [attr.aria-pressed]="activeFilter === 'video'"
          role="tab"
          [attr.aria-selected]="activeFilter === 'video'"
        >
          <span class="gallery-filter__label">Videos</span>
          <span class="gallery-filter__count">{{ totalVideos }}</span>
        </button>
      </div>

      <div class="gallery-actions">
        <span *ngIf="!isLoading && !loadError" class="gallery-status">
          <span class="gallery-status__dot" aria-hidden="true"></span>
          {{ filteredGalleryItems.length }}
          {{
            activeFilter === 'video'
              ? 'videos'
              : activeFilter === 'image'
                ? 'photos'
                : 'items'
          }}
        </span>
        <button class="gallery-refresh" type="button" (click)="loadGalleryItems()">
          <i class="ri-refresh-line" aria-hidden="true"></i>
          Refresh
        </button>
      </div>
    </div>

    <div *ngIf="loadError" class="gallery-error fade-up" role="alert">
      <div class="gallery-error__card">
        <h3 class="gallery-error__title">We couldn't load the gallery.</h3>
        <p class="gallery-error__copy">
          Please check your connection and try again. The curated visuals will be right back.
        </p>
        <button class="gallery-error__retry" type="button" (click)="loadGalleryItems()">
          Try again
        </button>
      </div>
    </div>

    <ng-container *ngIf="isLoading; else galleryContent">
      <div class="gallery-skeleton fade-up" aria-hidden="true">
        <div class="gallery-skeleton__card" *ngFor="let _ of skeletonPlaceholders"></div>
      </div>
    </ng-container>

    <ng-template #galleryContent>
      <ng-container *ngIf="filteredGalleryItems.length; else emptyGallery">
        <div class="gallery-masonry fade-up" role="list">
          <button
            type="button"
            class="gallery-card"
            *ngFor="let item of filteredGalleryItems; trackBy: trackById"
            (click)="openItem(item)"
            [attr.aria-label]="getAriaLabel(item)"
            role="listitem"
          >
            <span class="gallery-card__media">
              <img
                *ngIf="isImage(item)"
                [src]="mediaUrl(item)"
                [alt]="item.title || 'Gallery image'"
                loading="lazy"
                class="gallery-card__image"
                (error)="onImageError($event)"
              />
              <video
                *ngIf="isVideo(item)"
                [src]="mediaUrl(item)"
                muted
                loop
                playsinline
                preload="metadata"
                class="gallery-card__image"
                (error)="onImageError($event)"
              ></video>
            </span>

            <span class="gallery-card__meta">
              <span class="gallery-card__type" [class.gallery-card__type--video]="isVideo(item)">
                <i class="ri-camera-3-line" *ngIf="!isVideo(item)" aria-hidden="true"></i>
                <i class="ri-play-circle-line" *ngIf="isVideo(item)" aria-hidden="true"></i>
                {{ isVideo(item) ? 'Video' : 'Photo' }}
              </span>
              <span class="gallery-card__title">
                {{ item.title || 'Untitled item' }}
              </span>
            </span>
          </button>
        </div>
      </ng-container>
    </ng-template>
  </div>
</section>

<ng-template #emptyGallery>
  <div class="gallery-empty fade-up">
    <div class="gallery-empty__card">
      <span class="gallery-empty__eyebrow">Gallery coming soon</span>
      <p class="gallery-empty__title">We are curating something special.</p>
      <p class="gallery-empty__copy">
        Our creative team is capturing new moments from the latest residences. Check back shortly to experience the next chapter of AS Haven.
      </p>
    </div>
  </div>
</ng-template>

<!-- Lightbox Modal -->
<div
  *ngIf="lightboxOpen && currentItem"
  class="gallery-lightbox"
  (touchstart)="onTouchStart($event)"
  (touchend)="onTouchEnd($event)"
>
  <div class="gallery-lightbox__content">
    <button class="gallery-lightbox__close" (click)="closeLightbox()" aria-label="Close lightbox">
      <span aria-hidden="true">Ã—</span>
    </button>

    <ng-container *ngIf="currentItem">
      <img
        *ngIf="isImage(currentItem)"
        [src]="mediaUrl(currentItem)"
        [alt]="currentItem.title || 'Gallery image'"
        class="gallery-lightbox__media"
        (error)="onImageError($event)"
      />

      <video
        *ngIf="isVideo(currentItem)"
        [src]="mediaUrl(currentItem)"
        controls
        autoplay
        playsinline
        class="gallery-lightbox__media"
        (error)="onImageError($event)"
      ></video>
    </ng-container>

    <button class="gallery-lightbox__nav gallery-lightbox__nav--prev" (click)="prevItem($event)" aria-label="Previous item">
      <i class="ri-arrow-left-s-line" aria-hidden="true"></i>
    </button>
    <button class="gallery-lightbox__nav gallery-lightbox__nav--next" (click)="nextItem($event)" aria-label="Next item">
      <i class="ri-arrow-right-s-line" aria-hidden="true"></i>
    </button>
  </div>
</div>
