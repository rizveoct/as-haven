<app-gallery-hero />

<section class="gallery-app" id="projectGallery">
  <div class="gallery-app__wash"></div>
  <div class="gallery-app__wash gallery-app__wash--alt"></div>

  <div class="gallery-app__container">
    <header class="gallery-app__header fade-up">
      <div class="gallery-app__heading">
        <span class="gallery-app__eyebrow">Haven Stories</span>
        <h2 class="gallery-app__title">A living gallery of moments</h2>
        <p class="gallery-app__description">
          Browse the visuals that shape AS Haven. Every capture is curated to
          feel like a premium gallery app—fluid, cinematic, and alive with the
          brand palette.
        </p>
      </div>

      <dl class="gallery-app__stats">
        <div class="gallery-app__stat">
          <dt>Total spotlights</dt>
          <dd>{{ totalItems }}</dd>
        </div>
        <div class="gallery-app__stat">
          <dt>Stills</dt>
          <dd>{{ totalImages }}</dd>
        </div>
        <div class="gallery-app__stat">
          <dt>Films</dt>
          <dd>{{ totalVideos }}</dd>
        </div>
      </dl>
    </header>

    <div class="gallery-app__filter-shelf fade-up" role="tablist" aria-label="Gallery filters">
      <button
        type="button"
        class="gallery-pill"
        [class.is-active]="activeFilter === 'all'"
        (click)="setFilter('all')"
        [attr.aria-pressed]="activeFilter === 'all'"
        role="tab"
        [attr.aria-selected]="activeFilter === 'all'"
      >
        All
        <span class="gallery-pill__count">{{ totalItems }}</span>
      </button>
      <button
        type="button"
        class="gallery-pill"
        [class.is-active]="activeFilter === 'image'"
        (click)="setFilter('image')"
        [attr.aria-pressed]="activeFilter === 'image'"
        role="tab"
        [attr.aria-selected]="activeFilter === 'image'"
      >
        Images
        <span class="gallery-pill__count">{{ totalImages }}</span>
      </button>
      <button
        type="button"
        class="gallery-pill"
        [class.is-active]="activeFilter === 'video'"
        (click)="setFilter('video')"
        [attr.aria-pressed]="activeFilter === 'video'"
        role="tab"
        [attr.aria-selected]="activeFilter === 'video'"
      >
        Videos
        <span class="gallery-pill__count">{{ totalVideos }}</span>
      </button>
    </div>

    <ng-container *ngIf="filteredGalleryItems.length; else emptyGallery">
      <div class="gallery-app__feature-rail fade-up" *ngIf="featuredItem as hero">
        <button
          type="button"
          class="gallery-card gallery-card--hero"
          (click)="openItem(hero)"
          [attr.aria-label]="getAriaLabel(hero)"
        >
          <span class="gallery-card__thumb">
            <img
              *ngIf="isImage(hero)"
              [src]="mediaUrl(hero)"
              [alt]="hero.title"
              loading="lazy"
              class="gallery-card__media"
              (error)="onImageError($event)"
            />
            <video
              *ngIf="isVideo(hero)"
              [src]="mediaUrl(hero)"
              muted
              loop
              playsinline
              preload="metadata"
              class="gallery-card__media"
              (error)="onImageError($event)"
            ></video>
          </span>
          <span class="gallery-card__meta">
            <span class="gallery-card__type" [class.is-video]="isVideo(hero)">
              {{ isVideo(hero) ? 'Video feature' : 'Image feature' }}
            </span>
            <span class="gallery-card__title">
              {{ hero.title || 'Untitled showcase' }}
            </span>
            <span *ngIf="hero.description" class="gallery-card__excerpt">
              {{ hero.description }}
            </span>
            <span class="gallery-card__cta">Open in lightbox</span>
          </span>
        </button>

        <div class="gallery-app__side-stack">
          <div class="gallery-app__note">
            <p>Swipe or click through the gallery to experience each space.</p>
            <span class="gallery-app__note-accent">Tap the accent button to view full screen.</span>
          </div>
          <div class="gallery-app__chips">
            <span class="gallery-app__chip">Immersive</span>
            <span class="gallery-app__chip">Curated</span>
            <span class="gallery-app__chip">Responsive</span>
          </div>
        </div>
      </div>

      <div class="gallery-app__grid fade-up">
        <button
          type="button"
          class="gallery-card gallery-card--tile"
          *ngFor="let item of supportingItems; trackBy: trackById"
          (click)="openItem(item)"
          [attr.aria-label]="getAriaLabel(item)"
        >
          <span class="gallery-card__thumb">
            <img
              *ngIf="isImage(item)"
              [src]="mediaUrl(item)"
              [alt]="item.title"
              loading="lazy"
              class="gallery-card__media"
              (error)="onImageError($event)"
            />
            <video
              *ngIf="isVideo(item)"
              [src]="mediaUrl(item)"
              muted
              loop
              playsinline
              preload="metadata"
              class="gallery-card__media"
              (error)="onImageError($event)"
            ></video>
          </span>
          <span class="gallery-card__meta">
            <span class="gallery-card__type" [class.is-video]="isVideo(item)">
              {{ isVideo(item) ? 'Video' : 'Image' }}
            </span>
            <span class="gallery-card__title">
              {{ item.title || 'Untitled showcase' }}
            </span>
            <span *ngIf="item.description" class="gallery-card__excerpt">
              {{ item.description }}
            </span>
          </span>
        </button>
      </div>
    </ng-container>
  </div>
</section>

<ng-template #emptyGallery>
  <div class="gallery-empty fade-up">
    <div class="gallery-empty__card">
      <span class="gallery-empty__eyebrow">Gallery coming soon</span>
      <p class="gallery-empty__title">We are curating something special.</p>
      <p class="gallery-empty__copy">
        Our creative team is capturing new moments from the latest residences.
        Check back shortly to experience the next chapter of AS Haven.
      </p>
    </div>
  </div>
</ng-template>

<!-- Lightbox Modal -->
<div
  *ngIf="lightboxOpen && currentItem"
  class="gallery-lightbox"
  (touchstart)="onTouchStart($event)"
  (touchend)="onTouchEnd($event)"
>
  <div class="gallery-lightbox__content">
    <button
      class="gallery-lightbox__close"
      (click)="closeLightbox()"
      aria-label="Close lightbox"
    >
      <span aria-hidden="true">×</span>
    </button>

    <ng-container *ngIf="currentItem">
      <img
        *ngIf="isImage(currentItem)"
        [src]="mediaUrl(currentItem)"
        [alt]="currentItem.title"
        class="gallery-lightbox__media"
        (error)="onImageError($event)"
      />

      <video
        *ngIf="isVideo(currentItem)"
        [src]="mediaUrl(currentItem)"
        controls
        autoplay
        playsinline
        class="gallery-lightbox__media"
        (error)="onImageError($event)"
      ></video>
    </ng-container>

    <button
      class="gallery-lightbox__nav gallery-lightbox__nav--prev"
      (click)="prevItem($event)"
      aria-label="Previous item"
    >
      ❮
    </button>

    <button
      class="gallery-lightbox__nav gallery-lightbox__nav--next"
      (click)="nextItem($event)"
      aria-label="Next item"
    >
      ❯
    </button>
  </div>
</div>
